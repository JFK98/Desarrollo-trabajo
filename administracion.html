<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Administración - Flor y Vida</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <script src="js/api-contract.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      background: #f7f7f7; min-height: 100vh; 
    }
    .sidebar { 
      min-height: 100vh; 
      background: #fff; 
      border-right: 2px solid #e0e0e0; 
      padding: 0; 
      box-shadow: 2px 0 8px rgba(0,0,0,0.03); 
    }
    .sidebar .nav-link { 
      color: #333; 
      font-weight: 500; 
      padding: 1rem 1.5rem; 
      border-radius: 0; 
      cursor: pointer; 
    }
    .sidebar .nav-link.active, .sidebar .nav-link:hover { 
      background: #e3f2fd; 
      color: #1976d2; 
    }
    .modal-header { 
      background: #03a9f4; 
      color: #fff; 
      border-radius: 8px 8px 0 0; 
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <header class="d-flex justify-content-between align-items-center py-3 px-3 px-md-4">
      <h1 class="h3 mb-0">Panel de Administración</h1>
      <button id="btnCerrarSesion" class="btn btn-danger btn-sm">Cerrar Sesión</button>
    </header>

    <div class="row g-0">
      <nav class="col-md-2 bg-light sidebar">
        <ul class="nav flex-column" id="sidebarMenu">
          <li class="nav-item">
            <a class="nav-link active" href="#" data-section="dashboard"><i class="bi bi-graph-up"></i> Dashboard</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="#" data-section="usuarios"><i class="bi bi-people"></i> Usuarios</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-section="productos"><i class="bi bi-box"></i> Productos</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-section="pedidos"><i class="bi bi-cart-check"></i> Pedidos</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-section="reportes"><i class="bi bi-file-earmark-text"></i> Reportes</a></li>
        </ul>
      </nav>

      <main class="col-md-10 px-3 px-md-4 py-4">
        <div id="dashboard" class="section-content">
          <h2 class="mb-4">Dashboard</h2>
          <div class="row g-3">
            <div class="col-12 col-sm-6 col-lg-4"><div class="card h-100"><div class="card-body"><h5 class="card-title"><i class="bi bi-cash-coin"></i> Total Ventas</h5><p id="totalVentas" class="card-text fs-5">$0</p></div></div></div>
            <div class="col-12 col-sm-6 col-lg-4"><div class="card h-100"><div class="card-body"><h5 class="card-title"><i class="bi bi-box-seam"></i> Total Pedidos</h5><p id="totalPedidos" class="card-text fs-5">0</p></div></div></div>
            <div class="col-12 col-sm-6 col-lg-4"><div class="card h-100"><div class="card-body"><h5 class="card-title"><i class="bi bi-exclamation-triangle"></i> Stock Bajo</h5><p id="stockBajo" class="card-text fs-5">0</p></div></div></div>
          </div>
        </div>

        <div id="usuarios" class="section-content d-none">
          <h2 class="mb-4">Usuarios</h2>
          <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#modalCrear"><i class="bi bi-plus-circle"></i> Crear usuario</button>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="usuariosTable"><thead class="table-light"><tr><th>Nombre</th><th>Correo</th><th>Rol</th><th>Acciones</th></tr></thead><tbody></tbody></table>
          </div>
        </div>

        <div id="productos" class="section-content d-none">
          <h2 class="mb-4">Productos</h2>
          <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#modalCrearProducto"><i class="bi bi-plus-circle"></i> Crear Producto</button>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="productosTable"><thead class="table-light"><tr><th>Nombre</th><th>Precio</th><th>Stock</th><th>Temporada</th><th>Acciones</th></tr></thead><tbody></tbody></table>
          </div>
        </div>

        <div id="pedidos" class="section-content d-none">
          <h2 class="mb-4">Pedidos</h2>
          <div class="mb-3 d-flex flex-wrap gap-2">
            <button id="btnAnulacion" class="btn btn-warning"><i class="bi bi-x-circle"></i> Solicitudes de Anulación</button>
            <button id="btnVolverPedidos" class="btn btn-secondary d-none"><i class="bi bi-arrow-left-circle"></i> Volver a Pedidos</button>
          </div>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="pedidosTable">
              <thead class="table-light"><tr><th>ID Pedido</th><th>Cliente</th><th>Fecha</th><th>Total</th><th>Estado</th><th>Acciones</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div id="reportes" class="section-content d-none">
          <h2 class="mb-4">Reportes</h2>
          <form id="formReporte">
            <div class="row g-3 mb-3">
              <div class="col-12 col-sm-6"><select class="form-select" id="tipoReporte"><option value="diario">Diario</option><option value="mensual">Mensual</option><option value="anual">Anual</option></select></div>
              <div class="col-12 col-sm-6"><button type="button" id="btnConsultar" class="btn btn-primary w-100"><i class="bi bi-file-earmark-text"></i> Generar Reporte</button></div>
            </div>
          </form>
          <div id="reporteResultado" class="d-none alert alert-info"></div>
        </div>

      </main>
    </div>
  </div>

  <!-- Modal Crear Usuario -->
  <div class="modal fade" id="modalCrear" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header bg-primary text-white"><h5 class="modal-title"><i class="bi bi-plus-circle"></i> Crear Usuario</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <form id="crearUsuarioForm">
          <div class="mb-3"><label class="form-label fw-bold">Nombre</label><input type="text" name="nombre" class="form-control" required></div>
          <div class="mb-3"><label class="form-label fw-bold">Correo</label><input type="email" name="correo" class="form-control" required></div>
          <div class="mb-3"><label class="form-label fw-bold">Contraseña</label><input type="password" name="password" class="form-control" required></div>
          <div class="mb-3"><label class="form-label fw-bold">Rol</label><select name="rol" class="form-select" required><option value="cliente">Cliente</option><option value="admin">Admin</option><option value="encargado">Encargado</option><option value="dueño">Dueño</option></select></div>
          <div class="mb-3"><label class="form-label fw-bold">Teléfono</label><input type="text" name="telefono" class="form-control"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Cancelar</button>
        <button type="submit" form="crearUsuarioForm" class="btn btn-success"><i class="bi bi-check-circle"></i> Crear</button>
      </div>
    </div></div>
  </div>

  <!-- Modal Crear Producto -->
  <div class="modal fade" id="modalCrearProducto" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header bg-primary text-white"><h5 class="modal-title"><i class="bi bi-plus-circle"></i> Crear Producto</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <form id="crearProductoForm">
          <div class="mb-3"><label class="form-label fw-bold">Nombre</label><input type="text" name="nombre" class="form-control" required></div>
          <div class="mb-3"><label class="form-label fw-bold">Precio</label><input type="number" name="precio" class="form-control" step="0.01" required></div>
          <div class="mb-3"><label class="form-label fw-bold">Stock</label><input type="number" name="stock" class="form-control" required></div>
          <div class="mb-3"><label class="form-label fw-bold">Temporada</label><input type="text" name="temporada" class="form-control" placeholder="ej: Primavera, Verano, etc."></div>
          <div class="mb-3"><label class="form-label fw-bold">Imagen URL</label><input type="url" name="imagen" class="form-control"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Cancelar</button>
        <button type="submit" form="crearProductoForm" class="btn btn-success"><i class="bi bi-check-circle"></i> Crear</button>
      </div>
    </div></div>
  </div>

  <!-- Modal Actualizar Pedido -->
  <div class="modal fade" id="modalActualizarPedido" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg"><div class="modal-content">
      <div class="modal-header bg-primary text-white"><h5 class="modal-title"><i class="bi bi-pencil-square"></i> Actualizar Pedido</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <form id="formActualizarPedido">
          <div class="row mb-3 g-2">
            <div class="col-12 col-md-6"><label class="form-label fw-bold">ID Pedido</label><input type="text" class="form-control" id="pedidoId" readonly></div>
            <div class="col-12 col-md-6"><label class="form-label fw-bold">Estado</label><select id="estadoPedido" class="form-select" required><option value="pendiente">Pendiente</option><option value="confirmado">Confirmado</option><option value="preparacion">Preparación</option><option value="entregado">Entregado</option><option value="anulado">Anulado</option></select></div>
          </div>

          <div class="row mb-3 g-2">
            <div class="col-12 col-md-6"><label class="form-label fw-bold">Tipo de entrega</label><select id="entregaTipoPedido" class="form-select" disabled><option value="presencial">Retiro / Entrega presencial</option><option value="domicilio">Envío a domicilio</option></select></div>
            <div class="col-12 col-md-6 d-flex align-items-end"><div class="w-100"><label class="form-label fw-bold">Costo de envío</label><div class="form-control-plaintext py-2"> $<span id="shippingCostModal">0</span> </div></div></div>
          </div>

          <div class="mb-3"><label class="form-label fw-bold">Dirección de Entrega</label><input type="text" class="form-control" id="direccionPedido" name="direccion"></div>

          <div class="mb-3"><label class="form-label fw-bold">Productos del Pedido</label><div id="pedidoItems" class="alert alert-light"><p class="text-muted"><em>Cargando productos...</em></p></div></div>

          <div class="alert alert-info"><strong>Total del Pedido:</strong> $<span id="totalPedidoModal">0</span></div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Cancelar</button>
        <button type="submit" form="formActualizarPedido" class="btn btn-success"><i class="bi bi-check-circle"></i> Guardar cambios</button>
      </div>
    </div></div>
  </div>

  <!-- Modal Ver Pedido -->
  <div class="modal fade" id="modalVerPedido" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg"><div class="modal-content">
      <div class="modal-header bg-primary text-white"><h5 class="modal-title"><i class="bi bi-eye"></i> Detalle del Pedido</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <form id="formVerPedido">
          <div class="row mb-3 g-2">
            <div class="col-12 col-md-6"><label class="form-label fw-bold">ID Pedido</label><input type="text" class="form-control" id="verPedidoId" readonly></div>
            <div class="col-12 col-md-6"><label class="form-label fw-bold">Estado</label><input type="text" class="form-control" id="verEstadoPedido" readonly></div>
          </div>

          <div class="row mb-3 g-2">
            <div class="col-12 col-md-6"><label class="form-label fw-bold">Tipo de entrega</label><input type="text" class="form-control" id="verEntregaTipo" readonly></div>
            <div class="col-12 col-md-6 d-flex align-items-end"><div class="w-100"><label class="form-label fw-bold">Costo de envío</label><div class="form-control-plaintext py-2"> $<span id="verShippingCost">0</span> </div></div></div>
          </div>

          <div class="mb-3"><label class="form-label fw-bold">Dirección de Entrega</label><input type="text" class="form-control" id="verDireccionPedido" readonly></div>

          <div class="mb-3"><label class="form-label fw-bold">Productos del Pedido</label><div id="verPedidoItems" class="alert alert-light"><p class="text-muted"><em>Cargando productos...</em></p></div></div>

          <div class="alert alert-info"><strong>Total del Pedido:</strong> $<span id="verTotalPedido">0</span></div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Cerrar</button>
      </div>
    </div></div>
  </div>

  <!-- Modal Editar Usuario -->
  <div class="modal fade" id="modalEditarUsuario" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header bg-primary text-white"><h5 class="modal-title"><i class="bi bi-pencil-square"></i> Editar Usuario</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <form id="formEditarUsuario">
          <input type="hidden" id="usuarioIdEditar">
          <div class="mb-3"><label class="form-label fw-bold">Nombre</label><input type="text" id="nombreEditar" class="form-control" required></div>
          <div class="mb-3"><label class="form-label fw-bold">Correo</label><input type="email" id="correoEditar" class="form-control" required></div>
          <div class="mb-3"><label class="form-label fw-bold">Rol</label><select id="rolEditar" class="form-select" required><option value="cliente">Cliente</option><option value="admin">Admin</option><option value="encargado">Encargado</option><option value="dueño">Dueño</option></select></div>
          <div class="mb-3"><label class="form-label fw-bold">Teléfono</label><input type="text" id="telefonoEditar" class="form-control"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Cancelar</button>
        <button type="submit" form="formEditarUsuario" class="btn btn-success"><i class="bi bi-check-circle"></i> Guardar</button>
      </div>
    </div></div>
  </div>

  <!-- Scripts: carga en orden correcto -->
  <script src="js/api-client.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/administracion.js"></script>
  
</body>
</html>